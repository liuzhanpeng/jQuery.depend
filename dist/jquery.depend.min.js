!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(u){var r=function(e,n,t){this.handler=e,this.$selector=n,this.param=t};r.prototype={exec:function(){return this.handler(this.$selector,this.param)},test:function(e,n){return s.builtinRules.hasOwnProperty(e)||u.error("无效依赖规则:"+e),s.builtinRules[e](this.$selector,n)}};var n=function(){this.ruleHandlers=[]};n.prototype={add:function(e,n,t){this.ruleHandlers.push(new r(e,n,t))},check:function(){for(var e in this.ruleHandlers)if(!0!==this.ruleHandlers[e].exec())return!1;return!0}};var i=function(){this.ruleInspectors=[]};i.prototype={add:function(e){this.ruleInspectors.push(e)},check:function(){for(var e in this.ruleInspectors)if(!0===this.ruleInspectors[e].check())return!0;return!1}};var s=function(e,n,t){return this.$element=e,this.options=u.extend({},s.options,t),this.ruleInspectorGroup=new i,this.eventStore=[],this.options.onInit(e),s.handleDependants.call(this,n),this};s.handleDependants=function(e){var i=this,o=new n;u.each(e,function(t,e){var r=u(t);r.length||u.error("找不到依赖元素:"+t),e=u.extend({},{event:i.options.event,rule:{}},e),u.each(e.rule,function(e,n){s.builtinRules.hasOwnProperty(e)?o.add(s.builtinRules[e],r,n):"function"==typeof n?o.add(n,r,null):u.error("无效依赖规则:"+e)}),u.isArray(e.event)||u.error("依赖元素<"+t+">event选项无效"),u.each(e.event,function(e,n){i.eventStore.push({selector:r,event:n}),r.on(n,function(e){var n=i.ruleInspectorGroup.check();i.options.debug&&console.log("元素:<"+i.$element.selector+">;依赖元素:<"+t+">;事件:"+e.type+";检查结果:"+n),n?i.options.onPass(i.$element):i.options.onNotPass(i.$element)})})}),this.ruleInspectorGroup.add(o)},s.prototype={or:function(e){return s.handleDependants.call(this,e),this},exec:function(){u.each(this.eventStore,function(e,n){n.selector.trigger(n.event)})}},s.options={debug:!1,event:["change"],onInit:function(e){e.prop("disabled",!0)},onPass:function(e){e.removeProp("disabled")},onNotPass:function(e){e.prop("disabled",!0)}},s.getElementValue=function(e){if(e.is("input")&&"radio"===e.attr("type"))return e.filter(":checked").val();if(e.is("input")&&"checkbox"===e.attr("type")){var t=[];return e.filter(":checked").each(function(e,n){t.push(u(n).val())}),t}return e.val()},s.builtinRules={equal:function(e,n){var t=s.getElementValue(e);return typeof t==typeof n&&(u.isArray(t)&&u.isArray(n)?t.sort().toString()===n.sort().toString():t===n)},notEqual:function(e,n){return!this.equal(e,n)},any:function(e,n){u.isArray(n)||u.error("any规则参数必须为数组");var t=s.getElementValue(e);if(u.isArray(t)){for(var r in t)if(-1!==u.inArray(t[r],n))return!0;return!1}return-1!==u.inArray(t,n)},notAny:function(e,n){return!this.any(e,n)},contain:function(e,n){var t=s.getElementValue(e);return u.isArray(t)||u.error("contain规则元素的值必须为数组"),u.isArray(n)&&(n=n.sort().toString()),1!==(t=t.sort().toString()).indexOf(n)},notContain:function(e,n){return!$this.contain(e,n)}},u.fn.depend=function(e,n){return new s(this,e,n)},u.depend={config:function(e){s.options=u.extend({},s.options,e)},addRule:function(e,n){"function"!=typeof n&&u.error("无效自定义规则:"+e),s.builtinRules[e]=n},addRules:function(e){var t=this;u.each(e,function(e,n){t.addRule(e,n)})}}});