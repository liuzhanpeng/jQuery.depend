!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(s){var r=function(e,t,n){this.handler=e,this.$selector=t,this.param=n};r.prototype={exec:function(){return this.handler(this.$selector,this.param)},test:function(e,t){return u.builtinRules.hasOwnProperty(e)||s.error("无效依赖规则:"+e),u.builtinRules[e](this.$selector,t)}};var t=function(){this.ruleHandlers=[]};t.prototype={add:function(e,t,n){this.ruleHandlers.push(new r(e,t,n))},check:function(){for(var e in this.ruleHandlers)if(!0!==this.ruleHandlers[e].exec())return!1;return!0}};var i=function(){this.ruleInspectors=[]};i.prototype={add:function(e){this.ruleInspectors.push(e)},check:function(){for(var e in this.ruleInspectors)if(!0===this.ruleInspectors[e].check())return!0;return!1}};var u=function(e,t,n){return this.$element=e,this.options=s.extend({},u.options,n),this.ruleInspectorGroup=new i,this.eventStore=[],this.options.onInit(e),u.handleDependants.call(this,t),this};u.handleDependants=function(e){var i=this,o=new t;s.each(e,function(n,e){var r=s(n);r.length||s.error("找不到依赖元素:"+n),e=s.extend({},{event:i.options.event,rule:{}},e),s.each(e.rule,function(e,t){u.builtinRules.hasOwnProperty(e)?o.add(u.builtinRules[e],r,t):"function"==typeof t?o.add(t,r,null):s.error("无效依赖规则:"+e)}),s.isArray(e.event)||s.error("依赖元素<"+n+">event选项无效"),s.each(e.event,function(e,t){i.eventStore.push({selector:r,event:t}),r.on(t,function(e){var t=i.ruleInspectorGroup.check();i.options.debug&&console.log("元素:<"+i.$element.selector+">;依赖元素:<"+n+">;事件:"+e.type+";检查结果:"+t),t?i.options.onPass(i.$element):i.options.onNotPass(i.$element)})})}),this.ruleInspectorGroup.add(o)},u.prototype={or:function(e){return u.handleDependants.call(this,e),this},exec:function(){s.each(this.eventStore,function(e,t){t.selector.trigger(t.event)})}},u.options={debug:!1,event:["change"],onInit:function(e){e.prop("disabled",!0)},onPass:function(e){e.removeProp("disabled")},onNotPass:function(e){e.prop("disabled",!0)}},u.getElementValue=function(e){if(e.is("input")&&"radio"===e.attr("type"))return e.filter(":checked").val();if(e.is("input")&&"checkbox"===e.attr("type")){var n=[];return e.filter(":checked").each(function(e,t){n.push(s(t).val())}),n}return e.val()},u.builtinRules={equal:function(e,t){var n=u.getElementValue(e);return typeof n==typeof t&&(s.isArray(n)&&s.isArray(t)?n.sort().toString()===t.sort().toString():n===t)},notEqual:function(e,t){return!this.test("equal",t)},any:function(e,t){s.isArray(t)||s.error("any规则参数必须为数组");var n=u.getElementValue(e);if(s.isArray(n)){for(var r in n)if(-1!==s.inArray(n[r],t))return!0;return!1}return-1!==s.inArray(n,t)},notAny:function(e,t){return!this.test("any",t)},contain:function(e,t){var n=u.getElementValue(e);return s.isArray(n)||s.error("contain规则元素的值必须为数组"),s.isArray(t)&&(t=t.sort().toString()),-1!==(n=n.sort().toString()).indexOf(t)},notContain:function(e,t){return!$this.test("contain",t)}},s.fn.depend=function(e,t){return new u(this,e,t)},s.depend={config:function(e){u.options=s.extend({},u.options,e)},addRule:function(e,t){"function"!=typeof t&&s.error("无效自定义规则:"+e),u.builtinRules[e]=t},addRules:function(e){var n=this;s.each(e,function(e,t){n.addRule(e,t)})}}});